<!-- Chat Panel -->
<div class="chat-panel">
  <!-- Chat Header -->
  <div class="chat-panel__header">
    <div class="chat-panel__header-content">
      <div class="chat-panel__header-icon-placeholder"></div>
      <div class="chat-panel__header-info">
        <h3 class="chat-panel__header-title">Health Assistant</h3>
        <span class="chat-panel__header-status">Online</span>
      </div>
    </div>
  </div>

  <!-- Chat Messages Area -->
  <div class="chat-panel__messages" #messagesContainer>
    @for (message of messages(); track message.id) {
    <div
      class="message"
      [class.message--assistant]="message.isAssistant"
      [class.message--user]="!message.isAssistant"
      [class.message--loading]="message.type === 'loading'"
    >
      <!-- Message Avatar Placeholder -->
      <div class="message__avatar">
        <span class="message__avatar-placeholder"></span>
      </div>
      <!-- Message Content -->
      <div class="message__content">
        <div class="message__content-bubble">
          @if (message.type === 'loading') {
          <div class="message__content-loading">
            <span class="message__content-loading-dot"></span
            ><span class="message__content-loading-dot"></span
            ><span class="message__content-loading-dot"></span>
          </div>
          <span>{{ message.content }}</span>
          } @else {
          {{ message.content }}
          }
        </div>
        <div class="message__content-time">
          {{ message.timestamp | date : "short" }}
        </div>
      </div>
    </div>
    }

    <!-- Scroll to bottom anchor -->
    <div #scrollAnchor class="scroll-anchor"></div>
  </div>

  <!-- Chat Input Area -->
  <div class="chat-panel__input">
    <div class="chat-panel__input-container">
      <textarea
        class="chat-panel__input-field"
        [(ngModel)]="userInput"
        placeholder="Type your symptoms or health concern..."
        (keydown)="onEnterKey($event)"
        [disabled]="isLoading()"
      ></textarea>
      <button
        class="chat-panel__input-btn"
        (click)="sendMessage()"
        [disabled]="isLoading() || !userInput.trim()"
        aria-label="Send message"
      >
        @if (isLoading()) {
        <svg
          class="chat-panel__input-btn-spinner"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <circle cx="12" cy="12" r="10" />
          <path d="M12 6v6l4 2" />
        </svg>
        } @else {
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M22 2L11 13" />
          <path d="M22 2L15 22L11 13L2 9L22 2Z" />
        </svg>
        }
      </button>
    </div>
    <div class="chat-panel__controls">
      <button class="chat-panel__controls-btn" (click)="clearChat()">
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M3 6h18" />
          <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
          <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
          <line x1="10" y1="11" x2="10" y2="17" />
          <line x1="14" y1="11" x2="14" y2="17" />
        </svg>
        Clear chat
      </button>
      <div class="chat-panel__disclaimer">
        This is not a substitute for professional medical advice
      </div>
    </div>
  </div>
</div>
